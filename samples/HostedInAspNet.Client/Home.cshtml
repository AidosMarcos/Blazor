@using HostedInAspNet.Shared
@using System.Net.Http
@inject HttpClient httpClient
<h1>Hello, world!</h1>

@if (loaded)
{
    if (currentUser == null)
    {
        <LoggedOut />
    }
    else
    {
        <LoggedIn User=currentUser />
    }
}

@functions {
    bool loaded;
    UserInfo currentUser;

    protected override async Task OnInitAsync()
    {
        try
        {
            currentUser = await httpClient.GetJsonAsync<UserInfo>("auth/CurrentUserInfo");
        }
        catch (HttpRequestException)
        {
            // Not logged in
        }

        loaded = true;
    }
}
